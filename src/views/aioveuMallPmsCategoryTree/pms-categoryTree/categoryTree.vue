<template>
  <div class="app-container">





    <!-- Element Plus çš„æ …æ ¼å¸ƒå±€ç³»ç»Ÿ :gutter="10": åˆ—é—´è·ä¸º 10px -->
    <el-row :gutter="10">
      <!--
        å·¦ä¾§åˆ—ï¼šå•†å“åˆ†ç±»æ ‘
        :span="14": åœ¨å¤§å±å¹•ä¸‹å  14/24 çš„å®½åº¦
        :xs="24": åœ¨è¶…å°å±å¹•ï¼ˆæ‰‹æœºï¼‰ä¸‹å  24/24ï¼ˆå…¨å®½ï¼‰
      -->

      <el-col :span="14" :xs="24">

        <!-- å¡ç‰‡ç»„ä»¶ï¼Œç”¨äºåŒ…è£¹åˆ†ç±»æ ‘ shadow="always": å§‹ç»ˆæ˜¾ç¤ºé˜´å½±æ•ˆæœ-->
        <el-card class="box-card" shadow="always">
          <!--  å¡ç‰‡å¤´éƒ¨æ’æ§½  ä½¿ç”¨ svg-icon ç»„ä»¶æ˜¾ç¤ºèœå•å›¾æ ‡-->

          <template #header>
            å•†å“åˆ†ç±»    <!-- æ ‡é¢˜ -->
          </template>

          <!--Category ç»„ä»¶ï¼šå•†å“åˆ†ç±»æ ‘ç»„ä»¶ ref="categoryRef": ç»„ä»¶å¼•ç”¨ï¼Œå¯ä»¥é€šè¿‡ this.$refs.categoryRef è®¿é—®ç»„ä»¶å®ä¾‹
            @category-click="handleCategoryClick": ç›‘å¬åˆ†ç±»ç‚¹å‡»äº‹ä»¶-->

          <Category ref="categoryRef" @category-click="handleCategoryClick" />
        </el-card>
      </el-col>

      <!--
          å³ä¾§åˆ—ï¼šè§„æ ¼å±æ€§ç®¡ç†
          :span="10": åœ¨å¤§å±å¹•ä¸‹å  10/24 çš„å®½åº¦
          :xs="24": åœ¨è¶…å°å±å¹•ä¸‹å  24/24ï¼ˆå…¨å®½ï¼‰
       -->
      <el-col :span="10" :xs="24">

        <!--
            å¡ç‰‡ç»„ä»¶ï¼Œç”¨äºåŒ…è£¹è§„æ ¼å±æ€§ç®¡ç†åŒºåŸŸ
        -->
        <el-card class="box-card" shadow="always">
          <template #header>
            <!--
              å¡ç‰‡å¤´éƒ¨æ’æ§½
              æ˜¾ç¤ºå½“å‰é€‰ä¸­åˆ†ç±»çš„åç§°
            -->
            <!--            <svg-icon icon-class="menu" />-->
            <!--
              æ˜¾ç¤ºå½“å‰é€‰ä¸­åˆ†ç±»çš„åç§°
              å¦‚æœæœªé€‰æ‹©åˆ†ç±»ï¼Œæ˜¾ç¤º" è§„æ ¼å±æ€§"
              å¦‚æœé€‰æ‹©äº†åˆ†ç±»ï¼Œæ˜¾ç¤º"åˆ†ç±»åç§° è§„æ ¼å±æ€§"
            -->
            {{ category.name }} è§„æ ¼å±æ€§
          </template>
          <!--
              Attribute ç»„ä»¶ï¼šå•†å“è§„æ ¼ç®¡ç†ç»„ä»¶
              ref="specificationRef": ç»„ä»¶å¼•ç”¨
              :attributeType="1": ä¼ é€’å±æ€§ç±»å‹ï¼Œ1 è¡¨ç¤ºå•†å“è§„æ ¼
              :category="category": ä¼ é€’å½“å‰é€‰ä¸­çš„åˆ†ç±»ä¿¡æ¯
          -->
          <Attribute
            ref="specificationRef"
            :attributeType="1"
            :category="category"
          />
          <!--
              Attribute ç»„ä»¶ï¼šå•†å“å±æ€§ç®¡ç†ç»„ä»¶
              ref="attributeRef": ç»„ä»¶å¼•ç”¨
              :attributeType="2": ä¼ é€’å±æ€§ç±»å‹ï¼Œ2 è¡¨ç¤ºå•†å“å±æ€§
              :category="category": ä¼ é€’å½“å‰é€‰ä¸­çš„åˆ†ç±»ä¿¡æ¯
          -->
          <Attribute
            ref="attributeRef"
            :attributeType="2"
            :category="category"
          />
        </el-card>
      </el-col>
    </el-row>

<!--   ===========================================================================-->
  </div>
</template>

<script setup lang="ts">
defineOptions({
  name: "CategoryTree",
  inheritAttrs: false,
});

import { ref, onUnmounted } from 'vue'

// âŒ é—®é¢˜ä»£ç 
// ä½¿ç”¨ ref è€Œä¸æ˜¯ reactive + toRefs
const category  = ref({
  // å½“å‰é€‰ä¸­çš„å•†å“åˆ†ç±»ä¿¡æ¯
  id: undefined,  // åˆ†ç±»ID
  name: "",        // åˆ†ç±»åç§°
  childrenLen: 0,     // å­åˆ†ç±»æ•°é‡
});

// ç»„ä»¶å¼•ç”¨
const categoryRef = ref()
const specificationRef = ref()
const attributeRef = ref()

/**
 * å¤„ç†åˆ†ç±»ç‚¹å‡»äº‹ä»¶
 * å½“å·¦ä¾§åˆ†ç±»æ ‘ä¸­çš„åˆ†ç±»è¢«ç‚¹å‡»æ—¶è§¦å‘
 * @param categoryRow - ç‚¹å‡»çš„åˆ†ç±»èŠ‚ç‚¹æ•°æ®
 */
function handleCategoryClick(categoryRow: any) {

  // å¦‚æœæœ‰é€‰ä¸­åˆ†ç±»ï¼Œæ›´æ–°å½“å‰é€‰ä¸­çš„åˆ†ç±»ä¿¡æ¯
  if (categoryRow) {
    category.value = {
      id: categoryRow.id,   // åˆ†ç±»ID
      name: categoryRow.name,   // åˆ†ç±»åç§°
      childrenLen: categoryRow.children.length,  // å­åˆ†ç±»æ•°é‡
    };
  } else {

    // å¦‚æœæ²¡æœ‰é€‰ä¸­åˆ†ç±»ï¼ˆå¦‚å–æ¶ˆé€‰æ‹©ï¼‰ï¼Œé‡ç½®åˆ†ç±»ä¿¡æ¯
    category.value = {
      id: undefined,
      name: "",
      childrenLen: 0,
    };
  }
}

/**
 * ç»„ä»¶å¸è½½æ—¶çš„æ¸…ç†
 */
onUnmounted(() => {
  console.log('ğŸ—‘ï¸ CategoryPage ç»„ä»¶å¸è½½')

  // æ‰‹åŠ¨æ¸…ç†å­ç»„ä»¶å¼•ç”¨
  if (categoryRef.value) {
    const categoryTree = categoryRef.value

    // è°ƒç”¨å­ç»„ä»¶çš„æ¸…ç†æ–¹æ³•ï¼ˆå¦‚æœå­ç»„ä»¶æš´éœ²äº†ï¼‰
    if (categoryTree.$exposed?.cleanup) {
      categoryTree.$exposed.cleanup()
    }

    // æ¸…ç† DOM
    if (categoryTree.$el?.parentNode) {
      const parent = categoryTree.$el.parentNode
      while (parent.firstChild) {
        parent.removeChild(parent.firstChild)
      }
    }

    categoryRef.value = null
  }

  specificationRef.value = null
  attributeRef.value = null

  // æ¸…ç©º category æ•°æ®
  category.value = {
    id: undefined,
    name: "",
    childrenLen: 0,
  }

  // å¼ºåˆ¶è§¦å‘åƒåœ¾å›æ”¶ï¼ˆå¦‚æœæ”¯æŒï¼‰
  if (window.gc) {
    window.gc()
  }
})

//-------------------------------------------------------------------

</script>
<!--
  æ³¨æ„ï¼šæ²¡æœ‰ <style> éƒ¨åˆ†
  æ ·å¼å¯èƒ½é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç†ï¼š
  1. åœ¨å…¨å±€æ ·å¼æ–‡ä»¶ä¸­å®šä¹‰
  2. åœ¨çˆ¶ç»„ä»¶ä¸­å®šä¹‰
  3. é€šè¿‡ Element Plus çš„ç±»ååº”ç”¨é»˜è®¤æ ·å¼
-->

<!--
  å“åº”å¼è®¾è®¡è¯´æ˜ï¼š
  1. åœ¨å¤§å±å¹•ï¼ˆæ¡Œé¢ç«¯ï¼‰ï¼šå·¦ä¾§åˆ†ç±»æ ‘å  14/24ï¼Œå³ä¾§è§„æ ¼å±æ€§å  10/24
  2. åœ¨è¶…å°å±å¹•ï¼ˆæ‰‹æœºç«¯ï¼‰ï¼šå·¦å³ä¸¤ä¾§éƒ½å  24/24ï¼ˆå‚ç›´å †å ï¼‰
  3. é€šè¿‡ el-row å’Œ el-col å®ç°å“åº”å¼å¸ƒå±€
-->

<!--ç»„ä»¶è¯¦ç»†è¯´æ˜
1. ç»„ä»¶ä½œç”¨
è¿™æ˜¯ä¸€ä¸ªå•†å“åˆ†ç±»å’Œè§„æ ¼å±æ€§çš„ç®¡ç†é¡µé¢ï¼Œé‡‡ç”¨å·¦å³åˆ†æ å¸ƒå±€ï¼š
å·¦ä¾§ï¼šæ˜¾ç¤ºå•†å“åˆ†ç±»æ ‘ï¼Œå¯è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œ
å³ä¾§ï¼šæ ¹æ®å·¦ä¾§é€‰ä¸­çš„åˆ†ç±»ï¼Œæ˜¾ç¤ºå’Œç®¡ç†å¯¹åº”çš„å•†å“è§„æ ¼å’Œå±æ€§
2. æ ¸å¿ƒåŠŸèƒ½
åˆ†ç±»ç®¡ç†ï¼šé€šè¿‡ Category ç»„ä»¶ç®¡ç†å•†å“åˆ†ç±»æ ‘
è§„æ ¼ç®¡ç†ï¼šé€šè¿‡ Attribute ç»„ä»¶ç®¡ç†å•†å“è§„æ ¼ï¼ˆå¦‚é¢œè‰²ã€å°ºå¯¸ï¼‰
å±æ€§ç®¡ç†ï¼šé€šè¿‡ Attribute ç»„ä»¶ç®¡ç†å•†å“å±æ€§ï¼ˆå¦‚æè´¨ã€äº§åœ°ï¼‰
æ•°æ®è”åŠ¨ï¼šé€‰æ‹©ä¸åŒåˆ†ç±»æ—¶ï¼Œå³ä¾§è‡ªåŠ¨åˆ‡æ¢æ˜¾ç¤ºå¯¹åº”çš„è§„æ ¼å±æ€§
3. ç»„ä»¶é€šä¿¡æµç¨‹
ç”¨æˆ·ç‚¹å‡»å·¦ä¾§åˆ†ç±»æ ‘
â†“
Category ç»„ä»¶å‘å°„ category-click äº‹ä»¶
â†“
handleCategoryClick å‡½æ•°æ¥æ”¶äº‹ä»¶
â†“
æ›´æ–°å½“å‰é€‰ä¸­çš„åˆ†ç±»ä¿¡æ¯ (state.category)
â†“
é€šè¿‡ props ä¼ é€’ç»™å³ä¾§çš„ Attribute ç»„ä»¶
â†“
Attribute ç»„ä»¶æ ¹æ®åˆ†ç±» ID åŠ è½½å¯¹åº”çš„è§„æ ¼/å±æ€§æ•°æ®
4. å“åº”å¼è®¾è®¡
æ¡Œé¢ç«¯ï¼šå·¦å³åˆ†æ ï¼Œ14:10 çš„æ¯”ä¾‹
ç§»åŠ¨ç«¯ï¼šå‚ç›´å †å ï¼Œä¸Šä¸‹æ’åˆ—
é€šè¿‡ Element Plus çš„æ …æ ¼ç³»ç»Ÿå®ç°ï¼š
:span="14": åœ¨ä¸­ç­‰åŠä»¥ä¸Šå±å¹•å  14/24
:xs="24": åœ¨è¶…å°å±å¹•ï¼ˆ<768pxï¼‰å  24/24
5. çŠ¶æ€ç®¡ç†
state.category = {
id: undefined,      // åˆ†ç±»IDï¼Œç”¨äºæŸ¥è¯¢å¯¹åº”çš„è§„æ ¼å±æ€§
name: "",           // åˆ†ç±»åç§°ï¼Œç”¨äºæ˜¾ç¤ºåœ¨å³ä¾§æ ‡é¢˜
childrenLen: 0,     // å­åˆ†ç±»æ•°é‡ï¼Œå¯èƒ½ç”¨äºæ§åˆ¶æŸäº›æ“ä½œæƒé™
}
6. ç»„ä»¶äº¤äº’
1.ç”¨æˆ·åœ¨å·¦ä¾§åˆ†ç±»æ ‘ä¸­ç‚¹å‡»æŸä¸ªåˆ†ç±»
2.è§¦å‘ handleCategoryClickå‡½æ•°ï¼Œæ›´æ–°å½“å‰é€‰ä¸­åˆ†ç±»
3.å³ä¾§ä¸¤ä¸ª Attribute ç»„ä»¶æ¥æ”¶æ–°çš„åˆ†ç±»ä¿¡æ¯
4.Attribute ç»„ä»¶æ ¹æ®åˆ†ç±»IDåŠ è½½å¯¹åº”çš„æ•°æ®
5.ç”¨æˆ·å¯ä»¥ç®¡ç†è¯¥åˆ†ç±»ä¸‹çš„è§„æ ¼å’Œå±æ€§
7. æ³¨æ„äº‹é¡¹
æœªé€‰æ‹©åˆ†ç±»æ—¶ï¼šå³ä¾§æ˜¾ç¤º"è§„æ ¼å±æ€§"ï¼Œä½†å¯èƒ½ç¦ç”¨ç¼–è¾‘åŠŸèƒ½
å­ç»„ä»¶é€šä¿¡ï¼šé€šè¿‡ ref å¯ä»¥è®¿é—®å­ç»„ä»¶å®ä¾‹å’Œæ–¹æ³•
æ•°æ®åŒæ­¥ï¼šå½“å·¦ä¾§åˆ†ç±»å˜åŒ–æ—¶ï¼Œå³ä¾§æ•°æ®ä¼šè‡ªåŠ¨åˆ·æ–°
æ€§èƒ½è€ƒè™‘ï¼šé€šè¿‡ props ä¼ é€’æ•°æ®ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
8. æ‰©å±•æ€§
å¯ä»¥æ·»åŠ æ›´å¤šçš„å±æ€§ç®¡ç†ç»„ä»¶
å¯ä»¥æ·»åŠ åˆ†ç±»çš„æ‰¹é‡æ“ä½œåŠŸèƒ½
å¯ä»¥æ·»åŠ åˆ†ç±»çš„æ‹–æ‹½æ’åºåŠŸèƒ½
å¯ä»¥æ·»åŠ åˆ†ç±»çš„å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
9. ç”¨æˆ·ä½“éªŒ
æ¸…æ™°çš„è§†è§‰åˆ†å±‚ï¼šåˆ†ç±»æ ‘åœ¨å·¦ï¼Œè¯¦æƒ…åœ¨å³
å®æ—¶åé¦ˆï¼šç‚¹å‡»åˆ†ç±»ç«‹å³æ˜¾ç¤ºå¯¹åº”çš„è§„æ ¼å±æ€§
å“åº”å¼è®¾è®¡ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸
æ˜ç¡®çš„æ ‡é¢˜ï¼šæ˜¾ç¤ºå½“å‰æ“ä½œçš„æ˜¯å“ªä¸ªåˆ†ç±»
è¿™ä¸ªç»„ä»¶æ˜¯å•†å“åˆ†ç±»ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒé¡µé¢ï¼Œæä¾›äº†ç›´è§‚çš„åˆ†ç±»ç®¡ç†å’Œå¯¹åº”çš„å±æ€§é…ç½®ç•Œé¢ã€‚-->
